# ARX Testing Guide

## Overview
This document describes the testing approach and tools for the ARX programming language compiler and virtual machine.

## Testing Strategy

### Unit Testing
- **Lexer Tests**: Token recognition and error handling
- **Parser Tests**: Syntax parsing and AST generation
- **Code Generation Tests**: Bytecode generation verification
- **VM Tests**: Instruction execution and memory management

### Integration Testing
- **End-to-End Tests**: Complete compilation and execution
- **ARX Module Tests**: .arxmod file format validation
- **OO Feature Tests**: Inheritance, method overriding, NEW expressions

### Regression Testing
- **Feature Tests**: Ensure new features don't break existing functionality
- **Performance Tests**: Monitor compilation and execution performance
- **Compatibility Tests**: Cross-platform compatibility verification

## Test Structure

### Compiler Tests
```
compiler/test/
‚îú‚îÄ‚îÄ basic_compilation.arx      # Basic compilation tests
‚îú‚îÄ‚îÄ oo_features.arx            # Object-oriented feature tests
‚îú‚îÄ‚îÄ inheritance_test.arx       # Inheritance and method overriding
‚îú‚îÄ‚îÄ new_expression_test.arx    # NEW expression tests
‚îú‚îÄ‚îÄ constructor_test.arx       # Constructor parameter tests
‚îî‚îÄ‚îÄ error_handling.arx         # Error handling tests
```

### VM Tests
```
vm/test/
‚îú‚îÄ‚îÄ basic_execution.arx        # Basic VM execution tests
‚îú‚îÄ‚îÄ instruction_tests.arx      # Individual instruction tests
‚îú‚îÄ‚îÄ memory_tests.arx           # Memory management tests
‚îî‚îÄ‚îÄ oo_execution.arx           # OO feature execution tests
```

## Running Tests

### Compiler Tests
```bash
# Compile test programs
cd build
./arx -debug -show-bytecode ../compiler/test/basic_compilation.arx
./arx -debug -show-symbols ../compiler/test/oo_features.arx

# Check generated bytecode
./arxmod_info -sections ../compiler/test/basic_compilation.arxmod
./arxmod_info -hex ../compiler/test/basic_compilation.arxmod
```

### VM Tests
```bash
# Execute test programs
cd vm
./arxvm ../compiler/test/basic_compilation.arxmod
./arxvm -debug ../compiler/test/oo_features.arxmod
```

## Test Categories

### ‚úÖ Working Tests

#### Basic Compilation
```arx
module BasicTest;

class App
  procedure Main
  begin
    WriteLn('Hello, World!');
  end;
end;
```
**Expected**: Compiles successfully, generates bytecode with WRITELN instruction

#### NEW Expression Parsing
```arx
module NewTest;

class App
  procedure Main
  begin
    obj := new MyClass;
  end;
end;

class MyClass
  value: integer;
end;
```
**Expected**: Parses NEW expression, generates OPR_OBJ_NEW bytecode

#### Inheritance Parsing
```arx
module InheritanceTest;

class Parent
  name: string;
end;

class Child extends Parent
  age: integer;
end;
```
**Expected**: Parses inheritance, stores parent class in symbol table

#### Constructor Parameters
```arx
module ConstructorTest;

class App
  procedure Main
  begin
    obj := new MyClass(42, "hello");
  end;
end;

class MyClass
  value: integer;
  name: string;
  
  procedure init(x: integer; s: string)
  begin
    value := x;
    name := s;
  end;
end;
```
**Expected**: Parses constructor parameters, generates OPR_OBJ_CALL_METHOD bytecode

### üîÑ Partially Working Tests

#### String Output
```arx
module StringTest;

class App
  procedure Main
  begin
    WriteLn('Hello, World!');
  end;
end;
```
**Status**: Compiles successfully, but VM doesn't output strings (string storage issue)

#### Method Calls
```arx
module MethodTest;

class App
  procedure Main
  begin
    obj := new MyClass;
    obj.method();
  end;
end;

class MyClass
  procedure method
  begin
    WriteLn('Method called');
  end;
end;
```
**Status**: Parses successfully, but method calls not executed in VM

### ‚ùå Not Working Tests

#### Complex Expressions
```arx
module ExpressionTest;

class App
  procedure Main
  begin
    result := (10 + 5) * 2;
    WriteLn('Result: ', result);
  end;
end;
```
**Status**: Parses but doesn't generate complete bytecode

#### Control Flow
```arx
module ControlFlowTest;

class App
  procedure Main
  begin
    if (true) then
    begin
      WriteLn('Condition is true');
    end;
  end;
end;
```
**Status**: Not yet implemented

## Debugging Tools

### Compiler Debugging
```bash
# Enable debug output
./arx -debug program.arx

# Show generated bytecode
./arx -debug -show-bytecode program.arx

# Show symbol table
./arx -debug -show-symbols program.arx

# Show all debug information
./arx -debug -show-bytecode -show-symbols program.arx
```

### VM Debugging
```bash
# Enable VM debug output
./arxvm -debug program.arxmod

# Step through execution
./arxvm -debug -step program.arxmod

# Show memory state
./arxvm -debug -dump program.arxmod
```

### ARX Module Inspection
```bash
# Show module sections
./arxmod_info -sections program.arxmod

# Show hex dump
./arxmod_info -hex program.arxmod

# Show module information
./arxmod_info -info program.arxmod
```

## Test Data

### Sample Test Programs

#### Basic OO Test
```arx
module BasicOOTest;

class App
  procedure Main
  begin
    WriteLn('Testing OO Features');
    
    person := new Person;
    person.setName('John');
    person.setAge(30);
    
    WriteLn('Name: ', person.getName());
    WriteLn('Age: ', person.getAge());
  end;
end;

class Person
  name: string;
  age: integer;
  
  procedure init
  begin
    name := '';
    age := 0;
  end;
  
  procedure setName(n: string)
  begin
    name := n;
  end;
  
  procedure setAge(a: integer)
  begin
    age := a;
  end;
  
  function getName(): string
  begin
    return name;
  end;
  
  function getAge(): integer
  begin
    return age;
  end;
end;
```

#### Inheritance Test
```arx
module InheritanceTest;

class App
  procedure Main
  begin
    WriteLn('Testing Inheritance');
    
    animal := new Animal;
    dog := new Dog;
    
    animal.makeSound();
    dog.makeSound();
  end;
end;

class Animal
  name: string;
  
  procedure init
  begin
    name := 'Animal';
  end;
  
  procedure makeSound
  begin
    WriteLn('Some sound');
  end;
end;

class Dog extends Animal
  breed: string;
  
  procedure init
  begin
    name := 'Dog';
    breed := 'Unknown';
  end;
  
  procedure makeSound
  begin
    WriteLn('Woof!');
  end;
end;
```

## Performance Testing

### Compilation Performance
```bash
# Time compilation
time ./arx large_program.arx

# Memory usage during compilation
valgrind --tool=massif ./arx large_program.arx
```

### Execution Performance
```bash
# Time execution
time ./arxvm program.arxmod

# Profile execution
perf record ./arxvm program.arxmod
perf report
```

## Continuous Integration

### Automated Testing
```bash
#!/bin/bash
# test_runner.sh

echo "Running ARX Compiler Tests..."

# Test basic compilation
./arx -debug ../compiler/test/basic_compilation.arx
if [ $? -eq 0 ]; then
    echo "‚úÖ Basic compilation test passed"
else
    echo "‚ùå Basic compilation test failed"
    exit 1
fi

# Test OO features
./arx -debug ../compiler/test/oo_features.arx
if [ $? -eq 0 ]; then
    echo "‚úÖ OO features test passed"
else
    echo "‚ùå OO features test failed"
    exit 1
fi

# Test VM execution
./arxvm ../compiler/test/basic_compilation.arxmod
if [ $? -eq 0 ]; then
    echo "‚úÖ VM execution test passed"
else
    echo "‚ùå VM execution test failed"
    exit 1
fi

echo "All tests passed!"
```

## Test Coverage

### Current Coverage
- **Lexer**: 100% - All tokens and keywords tested
- **Parser**: 90% - Most syntax constructs tested
- **Code Generation**: 70% - Basic OO operations tested
- **VM**: 60% - Basic instruction execution tested

### Coverage Goals
- **Parser**: 95% - All syntax constructs
- **Code Generation**: 90% - All expression types
- **VM**: 80% - All instruction types
- **Integration**: 85% - End-to-end scenarios

## Best Practices

### Writing Tests
1. **Clear Test Names**: Use descriptive test names
2. **Isolated Tests**: Each test should be independent
3. **Expected Results**: Define clear expected outcomes
4. **Error Cases**: Test both success and failure scenarios
5. **Documentation**: Document test purpose and expected behavior

### Debugging
1. **Use Debug Flags**: Enable debug output for troubleshooting
2. **Check Bytecode**: Verify generated bytecode is correct
3. **Inspect Symbol Table**: Verify symbol table contents
4. **Trace Execution**: Use VM debug mode to trace execution
5. **Validate Modules**: Check ARX module format and contents

### Maintenance
1. **Regular Testing**: Run tests after each change
2. **Update Tests**: Update tests when adding new features
3. **Performance Monitoring**: Track compilation and execution performance
4. **Regression Testing**: Ensure new features don't break existing functionality
5. **Documentation**: Keep test documentation up to date
